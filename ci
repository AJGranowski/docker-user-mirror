#!/bin/sh
set -eC;

THIS_SCRIPT_DIR="$(dirname "$0" | xargs realpath)";

if command -v shellcheck >/dev/null; then
    grep -e '#!/bin/sh' --exclude-dir=.git -lR | xargs shellcheck --shell=sh --severity=warning
fi

if [ -z "$COMPOSE_ENGINE" ]; then
    (cd "$THIS_SCRIPT_DIR" && ./matrix-compose-engine matrix-images matrix-test-suite run-test);
else
    (cd "$THIS_SCRIPT_DIR" && COMPOSE_ENGINE="$COMPOSE_ENGINE" ./matrix-images matrix-test-suite run-test);
fi && echo 'All test pass!' || (echo 'Test failure.' >&2 && false);